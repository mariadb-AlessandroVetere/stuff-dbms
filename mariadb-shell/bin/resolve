#!/bin/bash
opt=$1

while true
do
    src=(`git diff --name-only .|uniq`)
    [ -n "${src[0]}" ] ||
        break

    if grep -q '^<<<<<<< ' "${src[@]}"
    then
      (cd ~/src; emacs "${src[@]}") ||
          break

      ([ "$opt" = only ] || grep -q '^<<<<<<< ' "${src[@]}") &&
          break

      make -j8 ||
          break
    fi

    git add "${src[@]}" ||
        break

    git rebase --continue
done



